<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>CVE-2021-20294.</title>

  
  <meta name="author" content="German">
  

  <meta name="description" content="Extended investigation about CVE-2021-20294 (unfinished).">

  

  

  
  <link rel="alternate" type="application/rss+xml" title="Home" href="http://localhost:4000/feed.xml">
  

  

  

  

  


  
    
      
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  
    
      <link rel="stylesheet" href="/assets/css/custom-dark.css">
    
  

  
  
  

  

  
  <meta property="og:site_name" content="Home">
  <meta property="og:title" content="CVE-2021-20294.">
  <meta property="og:description" content="Extended investigation about CVE-2021-20294 (unfinished).">

  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="German">
  <meta property="og:article:published_time" content="2025-11-07T00:00:00-05:00">
  <meta property="og:url" content="http://localhost:4000/2025-11-07-CVE-2021-20294/">
  <link rel="canonical" href="http://localhost:4000/2025-11-07-CVE-2021-20294/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@Qvintvs1">
  <meta name="twitter:creator" content="@Qvintvs1">

  <meta property="twitter:title" content="CVE-2021-20294.">
  <meta property="twitter:description" content="Extended investigation about CVE-2021-20294 (unfinished).">

  

  

  <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
    document.querySelectorAll("script[type='math/tex; mode=display']").forEach(function(el) {
      el.outerHTML = "\\[" + el.textContent + "\\]";
    });
    document.querySelectorAll("script[type='math/tex']").forEach(function(el) {
      el.outerHTML = "\\(" + el.textContent + "\\)";
    });
    var script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js';
    script.async = true;
    document.head.appendChild(script);
  });
</script>


  

  

</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="http://localhost:4000/">Home</a><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ms-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Program</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/Cpage">C</a>
                  <a class="dropdown-item" href="/DHARMApage">Dharma</a>
                  <a class="dropdown-item" href="/RUSTpage">Rust</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Web2</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/BURPSUITEpage">Burp</a>
                  <a class="dropdown-item" href="/THMpage">Thm</a>
                  <a class="dropdown-item" href="/HackTheBoxpage">Htb</a>
                  <a class="dropdown-item" href="/PEN200page">BasicPentesting</a>
                  <a class="dropdown-item" href="/REDTEAMBASICSpage">RedTeam</a>
                  <a class="dropdown-item" href="/BLUETEAMBASICSpage">Blueteam</a>
                  <a class="dropdown-item" href="/REDESpage">Net</a>
                  <a class="dropdown-item" href="/2022-11-17-GitBasics">Git</a>
                  <a class="dropdown-item" href="/CSOFTpage">MemCorrupt</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">ZKP</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/MATHpage">Math</a>
                  <a class="dropdown-item" href="/RUSTpage">Rust</a>
                  <a class="dropdown-item" href="/NOIRpage">Noir</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Assembly</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/ASSEMpage">x86</a>
            </div>
          </li>
        
        <li class="nav-item">
          <a class="nav-link" id="nav-search-link" href="#" title="Search">
            <span id="nav-search-icon" class="fa fa-search"></span>
            <span id="nav-search-text">Search</span>
          </a>
        </li></ul>
  </div>

  

  

</nav>



<div id="beautifuljekyll-search-overlay">

  <div id="nav-search-exit" title="Exit search">✕</div>
  <input type="text" id="nav-search-input" placeholder="Search">
  <ul id="search-results-container"></ul>
  
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    var searchjson = '[ \
       \
        { \
          "title"    : "P vs NP.", \
          "category" : "math", \
          "url"      : "/2026-01-11-PvsNP/", \
          "date"     : "January 11, 2026" \
        }, \
       \
        { \
          "title"    : "Race Conditions.", \
          "category" : "csoft", \
          "url"      : "/2025-12-28-RaceCondition/", \
          "date"     : "December 28, 2025" \
        }, \
       \
        { \
          "title"    : "Introducción al Cálculo", \
          "category" : "matemáticas", \
          "url"      : "/2025-12-25-MathTest/", \
          "date"     : "December 25, 2025" \
        }, \
       \
        { \
          "title"    : "Uninitialize Data Access.", \
          "category" : "csoft", \
          "url"      : "/2025-12-23-UDA/", \
          "date"     : "December 23, 2025" \
        }, \
       \
        { \
          "title"    : "Control Flow.", \
          "category" : "assem", \
          "url"      : "/2025-12-12-ControlFlow/", \
          "date"     : "December 12, 2025" \
        }, \
       \
        { \
          "title"    : "Other Integer Issues.", \
          "category" : "csoft", \
          "url"      : "/2025-12-05-OtherIntegerIssues/", \
          "date"     : "December  5, 2025" \
        }, \
       \
        { \
          "title"    : "Integer Overflow/Underflow.", \
          "category" : "csoft", \
          "url"      : "/2025-12-05-IntegerOverflow-Underflow/", \
          "date"     : "December  5, 2025" \
        }, \
       \
        { \
          "title"    : "Passing Parameters.", \
          "category" : "assem", \
          "url"      : "/2025-12-04-Passing-Parameters/", \
          "date"     : "December  4, 2025" \
        }, \
       \
        { \
          "title"    : "Stackframe; Local variables, Arrays and Structures.", \
          "category" : "assem", \
          "url"      : "/2025-12-01-LocalVars_Arrays_structs/", \
          "date"     : "December  1, 2025" \
        }, \
       \
        { \
          "title"    : "Out-Of-Bounds Write.", \
          "category" : "csoft", \
          "url"      : "/2025-11-26-Out-Of-Bounds-Write/", \
          "date"     : "November 26, 2025" \
        }, \
       \
        { \
          "title"    : "Calling Functions.", \
          "category" : "assem", \
          "url"      : "/2025-11-21-CallingFunctions/", \
          "date"     : "November 21, 2025" \
        }, \
       \
        { \
          "title"    : "(Linear) Heap Buffer Overflow.", \
          "category" : "csoft", \
          "url"      : "/2025-11-18-HBO/", \
          "date"     : "November 18, 2025" \
        }, \
       \
        { \
          "title"    : "Basic Instructions.", \
          "category" : "assem", \
          "url"      : "/2025-11-17-AssemblyBasicRegisters/", \
          "date"     : "November 17, 2025" \
        }, \
       \
        { \
          "title"    : "Computer Registers.", \
          "category" : "assem", \
          "url"      : "/2025-11-08-ComputerRegisters/", \
          "date"     : "November  8, 2025" \
        }, \
       \
        { \
          "title"    : "CVE-2021-20294.", \
          "category" : "csoft", \
          "url"      : "/2025-11-07-CVE-2021-20294/", \
          "date"     : "November  7, 2025" \
        }, \
       \
        { \
          "title"    : "(Linear) Stack Buffer Overflow.", \
          "category" : "csoft", \
          "url"      : "/2025-11-06-LSBO/", \
          "date"     : "November  6, 2025" \
        }, \
       \
        { \
          "title"    : "Text Editor.", \
          "category" : "C", \
          "url"      : "/2025-08-11-Text-Editor/", \
          "date"     : "August 11, 2025" \
        }, \
       \
        { \
          "title"    : "Garbage Collector.", \
          "category" : "C", \
          "url"      : "/2025-07-11-GarbageCollector/", \
          "date"     : "July 11, 2025" \
        }, \
       \
        { \
          "title"    : "Hashtables.", \
          "category" : "C", \
          "url"      : "/2025-06-13-HashTable/", \
          "date"     : "June 13, 2025" \
        }, \
       \
        { \
          "title"    : "Building my own malloc in C.", \
          "category" : "C", \
          "url"      : "/2025-06-09-BuildingOwnMalloc/", \
          "date"     : "June  9, 2025" \
        }, \
       \
        { \
          "title"    : "Malloc Tutorial", \
          "category" : "C", \
          "url"      : "/2025-06-06-MallocTutorial/", \
          "date"     : "June  6, 2025" \
        }, \
       \
        { \
          "title"    : "SharedLibraries&amp;FunctionHooking", \
          "category" : "C", \
          "url"      : "/2025-04-26-SharedLibraries&FunctionHooking/", \
          "date"     : "April 26, 2025" \
        }, \
       \
        { \
          "title"    : "File Descritors", \
          "category" : "C", \
          "url"      : "/2025-03-04-FileDescriptors/", \
          "date"     : "March  4, 2025" \
        }, \
       \
        { \
          "title"    : "Network Programming", \
          "category" : "C", \
          "url"      : "/2025-02-22-Network_Programming/", \
          "date"     : "February 22, 2025" \
        }, \
       \
        { \
          "title"    : "2. Constants and Literals in C.", \
          "category" : "C", \
          "url"      : "/2024-12-10-2.ConstantsinC-copy/", \
          "date"     : "December 10, 2024" \
        }, \
       \
        { \
          "title"    : "1. Basics of C", \
          "category" : "C", \
          "url"      : "/2024-12-02-1.BasicsOfC/", \
          "date"     : "December  2, 2024" \
        }, \
       \
        { \
          "title"    : "Gramáticas en Dharma", \
          "category" : "DHA", \
          "url"      : "/2024-09-24-Dharma_Tutorial/", \
          "date"     : "September 24, 2024" \
        }, \
       \
        { \
          "title"    : "Gramáticas en Dharma", \
          "category" : "fuzz", \
          "url"      : "/2024-03-22-Dharma_Tutorial-copy/", \
          "date"     : "March 22, 2024" \
        }, \
       \
        { \
          "title"    : "Mi experiencia con el OSCP", \
          "category" : "pen", \
          "url"      : "/2023-11-19-PEN200_Experience/", \
          "date"     : "November 19, 2023" \
        }, \
       \
        { \
          "title"    : "Client Side", \
          "category" : "pen", \
          "url"      : "/2023-11-17-17.Client_Side_Attacks/", \
          "date"     : "November 17, 2023" \
        }, \
       \
        { \
          "title"    : "Deep Packet Tunneling", \
          "category" : "pen", \
          "url"      : "/2023-11-16-16.Tunneling_Through_Deep_Packet_Inspection/", \
          "date"     : "November 16, 2023" \
        }, \
       \
        { \
          "title"    : "Report", \
          "category" : "pen", \
          "url"      : "/2023-11-15-15.Making_Reports/", \
          "date"     : "November 15, 2023" \
        }, \
       \
        { \
          "title"    : "Metasploit", \
          "category" : "pen", \
          "url"      : "/2023-11-14-14.Metasploit/", \
          "date"     : "November 14, 2023" \
        }, \
       \
        { \
          "title"    : "Password Attacks", \
          "category" : "pen", \
          "url"      : "/2023-11-13-13.Password_Attacks/", \
          "date"     : "November 13, 2023" \
        }, \
       \
        { \
          "title"    : "Active Directory Attacks", \
          "category" : "pen", \
          "url"      : "/2023-11-12-12.Active_Directory_Attacks/", \
          "date"     : "November 12, 2023" \
        }, \
       \
        { \
          "title"    : "Port Forwarding", \
          "category" : "pen", \
          "url"      : "/2023-11-11-11.Port_Forwarding/", \
          "date"     : "November 11, 2023" \
        }, \
       \
        { \
          "title"    : "Privilege Escalation", \
          "category" : "pen", \
          "url"      : "/2023-11-10-10.Privilege_Escalation/", \
          "date"     : "November 10, 2023" \
        }, \
       \
        { \
          "title"    : "File Transfers", \
          "category" : "pen", \
          "url"      : "/2023-11-09-9.File_Tranfers/", \
          "date"     : "November  9, 2023" \
        }, \
       \
        { \
          "title"    : "Buffer Overflows", \
          "category" : "pen", \
          "url"      : "/2023-11-08-8.Buffer_Overflows/", \
          "date"     : "November  8, 2023" \
        }, \
       \
        { \
          "title"    : "Vulnerability Scanning.", \
          "category" : "pen", \
          "url"      : "/2023-11-07-7.Vulnerability_Scanning/", \
          "date"     : "November  7, 2023" \
        }, \
       \
        { \
          "title"    : "Information Gathering", \
          "category" : "pen", \
          "url"      : "/2023-11-06-6.Active_Information_Gathering/", \
          "date"     : "November  6, 2023" \
        }, \
       \
        { \
          "title"    : "Windows", \
          "category" : "pen", \
          "url"      : "/2023-11-05-5.Windows/", \
          "date"     : "November  5, 2023" \
        }, \
       \
        { \
          "title"    : "Networking", \
          "category" : "pen", \
          "url"      : "/2023-11-04-4.Networking/", \
          "date"     : "November  4, 2023" \
        }, \
       \
        { \
          "title"    : "Scripting", \
          "category" : "pen", \
          "url"      : "/2023-11-03-3.Scripting/", \
          "date"     : "November  3, 2023" \
        }, \
       \
        { \
          "title"    : "Practical Tools", \
          "category" : "pen", \
          "url"      : "/2023-11-02-2.PracticalTools/", \
          "date"     : "November  2, 2023" \
        }, \
       \
        { \
          "title"    : "Linux", \
          "category" : "pen", \
          "url"      : "/2023-11-01-1.Linux/", \
          "date"     : "November  1, 2023" \
        }, \
       \
        { \
          "title"    : "Easy", \
          "category" : "hack", \
          "url"      : "/2022-12-01-Easy/", \
          "date"     : "December  1, 2022" \
        }, \
       \
        { \
          "title"    : "Git Basics", \
          "category" : "", \
          "url"      : "/2022-11-17-GitBasics/", \
          "date"     : "November 17, 2022" \
        }, \
       \
        { \
          "title"    : "Tier I", \
          "category" : "hack", \
          "url"      : "/2022-11-10-Tier_1/", \
          "date"     : "November 10, 2022" \
        }, \
       \
        { \
          "title"    : "Tier 0", \
          "category" : "hack", \
          "url"      : "/2022-11-09-Tier_0/", \
          "date"     : "November  9, 2022" \
        }, \
       \
        { \
          "title"    : "7.BufferOverflow.", \
          "category" : "thm", \
          "url"      : "/2022-11-02-7.BufferOverflow/", \
          "date"     : "November  2, 2022" \
        }, \
       \
        { \
          "title"    : "6.Offensive Pentesting", \
          "category" : "thm", \
          "url"      : "/2022-11-01-6.OffensivePentesting/", \
          "date"     : "November  1, 2022" \
        }, \
       \
        { \
          "title"    : "5.RedTeam", \
          "category" : "thm", \
          "url"      : "/2022-10-30-5.RedTeam/", \
          "date"     : "October 30, 2022" \
        }, \
       \
        { \
          "title"    : "4.Windows", \
          "category" : "thm", \
          "url"      : "/2022-10-22-4.Windows/", \
          "date"     : "October 22, 2022" \
        }, \
       \
        { \
          "title"    : "3.Junior Penetrationtester path", \
          "category" : "thm", \
          "url"      : "/2022-09-02-3.JRPenetrationTester/", \
          "date"     : "September  2, 2022" \
        }, \
       \
        { \
          "title"    : "2.Complete Begginer path.", \
          "category" : "thm", \
          "url"      : "/2022-08-07-2.CompleteBegginer/", \
          "date"     : "August  7, 2022" \
        }, \
       \
        { \
          "title"    : "1.Pre-Security path.", \
          "category" : "thm", \
          "url"      : "/2022-07-11-1Pre-Security/", \
          "date"     : "July 11, 2022" \
        }, \
       \
        { \
          "title"    : "0.Scripting for pentesters.", \
          "category" : "thm", \
          "url"      : "/2022-07-10-0.Scripting_for_pentesters/", \
          "date"     : "July 10, 2022" \
        }, \
       \
        { \
          "title"    : "Burp Certified Practitioner Practice Exam.", \
          "category" : "burp", \
          "url"      : "/2022-03-30-PracticeExam/", \
          "date"     : "March 30, 2022" \
        }, \
       \
        { \
          "title"    : "22. OAuth Authentication.", \
          "category" : "burp", \
          "url"      : "/2022-03-27-22.OAuth_authentication/", \
          "date"     : "March 27, 2022" \
        }, \
       \
        { \
          "title"    : "21. HTTP Request Smuggling.", \
          "category" : "burp", \
          "url"      : "/2022-03-26-21.HTTP_request_smuggling/", \
          "date"     : "March 26, 2022" \
        }, \
       \
        { \
          "title"    : "20. HTTP Host Header Attacks.", \
          "category" : "burp", \
          "url"      : "/2022-03-25-20.HTTP_Host_header_attacks/", \
          "date"     : "March 25, 2022" \
        }, \
       \
        { \
          "title"    : "19. Web Cache Poisoning.", \
          "category" : "burp", \
          "url"      : "/2022-03-24-19.Web_cache_poisoning/", \
          "date"     : "March 24, 2022" \
        }, \
       \
        { \
          "title"    : "18. Server-Side Template Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-23-18.Serve-side_template_injection/", \
          "date"     : "March 23, 2022" \
        }, \
       \
        { \
          "title"    : "17. Insecure Deserialization.", \
          "category" : "burp", \
          "url"      : "/2022-03-22-17.Insecure_deserialization/", \
          "date"     : "March 22, 2022" \
        }, \
       \
        { \
          "title"    : "16. WebSockets.", \
          "category" : "burp", \
          "url"      : "/2022-03-21-16.WebSockets/", \
          "date"     : "March 21, 2022" \
        }, \
       \
        { \
          "title"    : "15.DOM-based XSS vulnerabilities.", \
          "category" : "burp", \
          "url"      : "/2022-03-20-15-DOM-based_vulnerabilities/", \
          "date"     : "March 20, 2022" \
        }, \
       \
        { \
          "title"    : "14. Clickjacking.", \
          "category" : "burp", \
          "url"      : "/2022-03-19-14.Clickjacking/", \
          "date"     : "March 19, 2022" \
        }, \
       \
        { \
          "title"    : "13. Cross-Origin Resource Sharing.", \
          "category" : "burp", \
          "url"      : "/2022-03-18-13.Cross-origin_resource_sharing_(CORS)/", \
          "date"     : "March 18, 2022" \
        }, \
       \
        { \
          "title"    : "12. Cross-Site Request Forgery.", \
          "category" : "burp", \
          "url"      : "/2022-03-17-12.Cross-site_request_forgery_(CSRF)/", \
          "date"     : "March 17, 2022" \
        }, \
       \
        { \
          "title"    : "11. Cross-Site Scripting.", \
          "category" : "burp", \
          "url"      : "/2022-03-16-11.Cross-site_scripting_(XSS)/", \
          "date"     : "March 16, 2022" \
        }, \
       \
        { \
          "title"    : "10. XXE Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-15-10.XXE_injection/", \
          "date"     : "March 15, 2022" \
        }, \
       \
        { \
          "title"    : "9. Server-Side Request Forgery.", \
          "category" : "burp", \
          "url"      : "/2022-03-14-9.Server-side_request_forgery/", \
          "date"     : "March 14, 2022" \
        }, \
       \
        { \
          "title"    : "8. File Upload.", \
          "category" : "burp", \
          "url"      : "/2022-03-13-8.File_upload_vulnerabilities/", \
          "date"     : "March 13, 2022" \
        }, \
       \
        { \
          "title"    : "7. Access Control.", \
          "category" : "burp", \
          "url"      : "/2022-03-12-7.Access_control/", \
          "date"     : "March 12, 2022" \
        }, \
       \
        { \
          "title"    : "6. Information Disclosure.", \
          "category" : "burp", \
          "url"      : "/2022-03-11-6.Information_disclosure/", \
          "date"     : "March 11, 2022" \
        }, \
       \
        { \
          "title"    : "5. Bussiness Logic Vulnerabilities.", \
          "category" : "burp", \
          "url"      : "/2022-03-10-5.Business_logic_vulnerabilities/", \
          "date"     : "March 10, 2022" \
        }, \
       \
        { \
          "title"    : "4. Command Injection.", \
          "category" : "burp", \
          "url"      : "/2022-03-09-4.Command_Injection/", \
          "date"     : "March  9, 2022" \
        }, \
       \
        { \
          "title"    : "3. Directory Traversal.", \
          "category" : "burp", \
          "url"      : "/2022-03-08-3.Directory_Traversal/", \
          "date"     : "March  8, 2022" \
        }, \
       \
        { \
          "title"    : "2. Authentication.", \
          "category" : "burp", \
          "url"      : "/2022-03-07-2.Authentication/", \
          "date"     : "March  7, 2022" \
        }, \
       \
        { \
          "title"    : "1. SQLInjection", \
          "category" : "burp", \
          "url"      : "/2022-03-06-1.SQLInjection/", \
          "date"     : "March  6, 2022" \
        }, \
       \
        { \
          "title"    : "Seguridad Perimetral", \
          "category" : "blueteam", \
          "url"      : "/2022-02-09-Seguridad_Perimetral/", \
          "date"     : "February  9, 2022" \
        }, \
       \
        { \
          "title"    : "Hardening de sistemas", \
          "category" : "blueteam", \
          "url"      : "/2022-02-09-Hardening_de_sistemas/", \
          "date"     : "February  9, 2022" \
        }, \
       \
        { \
          "title"    : "Bandit", \
          "category" : "otw", \
          "url"      : "/2022-02-08-Bandit/", \
          "date"     : "February  8, 2022" \
        }, \
       \
        { \
          "title"    : "Proxy", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Proxys/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Protocolos Relevantes", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Protocolos_Importantes/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Curso Básico Redes", \
          "category" : "redes", \
          "url"      : "/2022-02-07-Precurso_Redes/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "IPs", \
          "category" : "redes", \
          "url"      : "/2022-02-07-IPs/", \
          "date"     : "February  7, 2022" \
        }, \
       \
        { \
          "title"    : "Movimientos Laterales", \
          "category" : "redteam", \
          "url"      : "/2022-02-06-Introducci%C3%B3n_a_movimientos_laterales/", \
          "date"     : "February  6, 2022" \
        }, \
       \
        { \
          "title"    : "Evasión de Defensas", \
          "category" : "redteam", \
          "url"      : "/2022-02-05-Evasi%C3%B3n_de_Defensas/", \
          "date"     : "February  5, 2022" \
        }, \
       \
        { \
          "title"    : "Escalada de privilegios", \
          "category" : "redteam", \
          "url"      : "/2022-02-05-Escalada_de_privilegios/", \
          "date"     : "February  5, 2022" \
        }, \
       \
        { \
          "title"    : "Metasploit", \
          "category" : "redteam", \
          "url"      : "/2022-02-04-Metasploit_B%C3%A1sico/", \
          "date"     : "February  4, 2022" \
        }, \
       \
        { \
          "title"    : "Ataques a aplicaciones Android", \
          "category" : "redteam", \
          "url"      : "/2022-02-03-Ataques_aplicaciones_android/", \
          "date"     : "February  3, 2022" \
        }, \
       \
        { \
          "title"    : "Ataque a aplicaciones web.", \
          "category" : "redteam", \
          "url"      : "/2022-02-02-Ataques_a_aplicaciones_web/", \
          "date"     : "February  2, 2022" \
        }, \
       \
        { \
          "title"    : "Ataques a Infraestructuras y Redes", \
          "category" : "redteam", \
          "url"      : "/2022-02-01-Ataques_a_Infraestructuras_y_Redes/", \
          "date"     : "February  1, 2022" \
        }, \
       \
        { \
          "title"    : "Análisis de Objetivos", \
          "category" : "redteam", \
          "url"      : "/2022-01-28-An%C3%A1lisis_de_Objetivos/", \
          "date"     : "January 28, 2022" \
        }, \
       \
       \
        { \
          "title"    : "Assembly and Architecture Introduction.", \
          "category" : "page", \
          "url"      : "/ASSEMpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Blueteam Basics", \
          "category" : "page", \
          "url"      : "/BLUETEAMBASICSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "PortSwigger BurpSuite Course", \
          "category" : "page", \
          "url"      : "/BURPSUITEpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "C-Family Software Memory Corruption Vulnerabilities", \
          "category" : "page", \
          "url"      : "/CSOFTpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "C &amp; Systems Fundamentals.", \
          "category" : "page", \
          "url"      : "/Cpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Dharma Fuzzer language", \
          "category" : "page", \
          "url"      : "/DHARMApage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Exploiting &amp; Reversing", \
          "category" : "page", \
          "url"      : "/EXPREVpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Fuzzing JavaScript Engine", \
          "category" : "page", \
          "url"      : "/Fuzzpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "HackTheBox", \
          "category" : "page", \
          "url"      : "/HackTheBoxpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "TryHackMe", \
          "category" : "page", \
          "url"      : "/MATHpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "PEN200 notes", \
          "category" : "page", \
          "url"      : "/PEN200page/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Proyectos", \
          "category" : "page", \
          "url"      : "/PROJECTSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Networking Basics", \
          "category" : "page", \
          "url"      : "/REDESpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "RedTeam Basics", \
          "category" : "page", \
          "url"      : "/REDTEAMBASICSpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Retired Machines", \
          "category" : "page", \
          "url"      : "/RetiredMachinespage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "TryHackMe", \
          "category" : "page", \
          "url"      : "/THMpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "About me", \
          "category" : "page", \
          "url"      : "/aboutme/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "THM", \
          "category" : "page", \
          "url"      : "/preOSCPpage/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Tag Index", \
          "category" : "page", \
          "url"      : "/tags/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page2/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page3/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page4/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page5/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page6/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page7/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page8/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page9/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page10/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page11/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page12/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page13/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page14/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page15/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page16/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page17/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page18/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page19/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/page20/", \
          "date"     : "January 1, 1970" \
        } \
       \
    ]';
    searchjson = JSON.parse(searchjson);

    var sjs = SimpleJekyllSearch({
      searchInput: document.getElementById('nav-search-input'),
      resultsContainer: document.getElementById('search-results-container'),
      json: searchjson
    });
  </script>
</div>





  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>CVE-2021-20294.</h1>
          
            
              <h2 class="post-subheading">Extended investigation about CVE-2021-20294 (unfinished).</h2>
            
          

          
            <span class="post-meta">Posted on November 7, 2025</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <h3 id="1-introduction">1. Introduction.</h3>

<p>This is an exploit for CVE-2021-20294.</p>

<p>This vulnerability consists in a “linear stack buffer overflow” on the version 2.35 of binutils (downloaded from https://ftp.gnu.org/gnu/binutils/binutils-2.35.tar.gz).</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">void</span>
<span class="nf">print_dynamic_symbol</span> <span class="p">(</span><span class="n">Filedata</span> <span class="o">*</span><span class="n">filedata</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">si</span><span class="p">,</span>
		      <span class="n">Elf_Internal_Sym</span> <span class="o">*</span><span class="n">symtab</span><span class="p">,</span>
		      <span class="n">Elf_Internal_Shdr</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span>
		      <span class="kt">char</span> <span class="o">*</span><span class="n">strtab</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">strtab_size</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">version_string</span><span class="p">;</span>
  <span class="k">enum</span> <span class="n">versioned_symbol_info</span> <span class="n">sym_info</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">vna_other</span><span class="p">;</span>
  <span class="n">Elf_Internal_Sym</span> <span class="o">*</span><span class="n">psym</span> <span class="o">=</span> <span class="n">symtab</span> <span class="o">+</span> <span class="n">si</span><span class="p">;</span>
  
  <span class="n">printf</span> <span class="p">(</span><span class="s">"%6ld: "</span><span class="p">,</span> <span class="n">si</span><span class="p">);</span>
  <span class="n">print_vma</span> <span class="p">(</span><span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_value</span><span class="p">,</span> <span class="n">LONG_HEX</span><span class="p">);</span>
  <span class="n">putchar</span> <span class="p">(</span><span class="sc">' '</span><span class="p">);</span>
  <span class="n">print_vma</span> <span class="p">(</span><span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_size</span><span class="p">,</span> <span class="n">DEC_5</span><span class="p">);</span>
  <span class="n">printf</span> <span class="p">(</span><span class="s">" %-7s"</span><span class="p">,</span> <span class="n">get_symbol_type</span> <span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="n">ELF_ST_TYPE</span> <span class="p">(</span><span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_info</span><span class="p">)));</span>
  <span class="n">printf</span> <span class="p">(</span><span class="s">" %-6s"</span><span class="p">,</span> <span class="n">get_symbol_binding</span> <span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="n">ELF_ST_BIND</span> <span class="p">(</span><span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_info</span><span class="p">)));</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">filedata</span><span class="o">-&gt;</span><span class="n">file_header</span><span class="p">.</span><span class="n">e_ident</span><span class="p">[</span><span class="n">EI_OSABI</span><span class="p">]</span> <span class="o">==</span> <span class="n">ELFOSABI_SOLARIS</span><span class="p">)</span>
    <span class="n">printf</span> <span class="p">(</span><span class="s">" %-7s"</span><span class="p">,</span>  <span class="n">get_solaris_symbol_visibility</span> <span class="p">(</span><span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_other</span><span class="p">));</span>
  <span class="k">else</span>
    <span class="p">{</span>
      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vis</span> <span class="o">=</span> <span class="n">ELF_ST_VISIBILITY</span> <span class="p">(</span><span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_other</span><span class="p">);</span>

      <span class="n">printf</span> <span class="p">(</span><span class="s">" %-7s"</span><span class="p">,</span> <span class="n">get_symbol_visibility</span> <span class="p">(</span><span class="n">vis</span><span class="p">));</span>
      <span class="cm">/* Check to see if any other bits in the st_other field are set.
	 Note - displaying this information disrupts the layout of the
	 table being generated, but for the moment this case is very rare.  */</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_other</span> <span class="o">^</span> <span class="n">vis</span><span class="p">)</span>
	<span class="n">printf</span> <span class="p">(</span><span class="s">" [%s] "</span><span class="p">,</span> <span class="n">get_symbol_other</span> <span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_other</span> <span class="o">^</span> <span class="n">vis</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="n">printf</span> <span class="p">(</span><span class="s">" %4s "</span><span class="p">,</span> <span class="n">get_symbol_index_type</span> <span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_shndx</span><span class="p">));</span>

  <span class="n">bfd_boolean</span> <span class="n">is_valid</span> <span class="o">=</span> <span class="n">VALID_SYMBOL_NAME</span> <span class="p">(</span><span class="n">strtab</span><span class="p">,</span> <span class="n">strtab_size</span><span class="p">,</span>
					    <span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_name</span><span class="p">);</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">sstr</span> <span class="o">=</span> <span class="n">is_valid</span>  <span class="o">?</span> <span class="n">strtab</span> <span class="o">+</span> <span class="n">psym</span><span class="o">-&gt;</span><span class="n">st_name</span> <span class="o">:</span> <span class="n">_</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>

  <span class="n">version_string</span>
    <span class="o">=</span> <span class="n">get_symbol_version_string</span> <span class="p">(</span><span class="n">filedata</span><span class="p">,</span>
				 <span class="p">(</span><span class="n">section</span> <span class="o">==</span> <span class="nb">NULL</span>
				  <span class="o">||</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_type</span> <span class="o">==</span> <span class="n">SHT_DYNSYM</span><span class="p">),</span>
				 <span class="n">strtab</span><span class="p">,</span> <span class="n">strtab_size</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span>
				 <span class="n">psym</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sym_info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vna_other</span><span class="p">);</span> 
  
  <span class="kt">int</span> <span class="n">len_avail</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">do_wide</span> <span class="o">&amp;&amp;</span> <span class="n">version_string</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> 
    <span class="p">{</span>
      <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

      <span class="n">len_avail</span> <span class="o">-=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"@%s"</span><span class="p">,</span> <span class="n">version_string</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">sym_info</span> <span class="o">==</span> <span class="n">symbol_undefined</span><span class="p">)</span>
	<span class="n">len_avail</span> <span class="o">-=</span> <span class="n">sprintf</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="s">" (%d)"</span><span class="p">,</span> <span class="n">vna_other</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sym_info</span> <span class="o">!=</span> <span class="n">symbol_hidden</span><span class="p">)</span>
	<span class="n">len_avail</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="n">print_symbol</span> <span class="p">(</span><span class="n">len_avail</span><span class="p">,</span> <span class="n">sstr</span><span class="p">);</span>
<span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <em>sprintf()</em> function is a weak-bounded function that introduces an attacker-controlled variable on a buffer:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">do_wide</span> <span class="o">&amp;&amp;</span> <span class="n">version_string</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
    <span class="n">len_avail</span> <span class="o">-=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"@%s"</span><span class="p">,</span> <span class="n">version_string</span><span class="p">);</span> <span class="c1">//version_string is attacker-controlled.</span>
	<span class="c1">// ...</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-first-steps-static-analysis">2. First Steps. (Static Analysis).</h3>

<p>In order to be able to write a PoC, we have to identify where the user interact with the content of this parameter, in other words, how the program fill this buffer with user’s data.</p>

<p><br /></p>

<h4 id="21-tracking-buffer-content">2.1. Tracking buffer content.</h4>

<p>In the code we can see that <em>buffer</em> (line 12096), an array of chars, is stuffed by <em>version_string</em> through <em>sprintf()</em>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">do_wide</span> <span class="o">&amp;&amp;</span> <span class="n">version_string</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
      <span class="n">len_avail</span> <span class="o">-=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"@%s"</span><span class="p">,</span> <span class="n">version_string</span><span class="p">);</span>
      <span class="c1">//...</span>
</code></pre></div></div>

<p>This is done with an <em>if</em> statement when:</p>

<ul>
  <li>
    <p><em>do_wide</em> is false.</p>
  </li>
  <li>
    <p><em>version_string</em> is not an empty string.</p>
  </li>
</ul>

<p>So here we have a new condition; we also have to track what is <em>do_wide</em> and when is set to false (a quick check show us that this is when W flag is enable in the cli, we will explain this in detail later).</p>

<p>So, we move on tracking up the content of <em>buffer</em>. This content comes from <em>version_string</em>; a pointer to char (as we can see on the declaration at line 12029), which holds the return value of the function <em>get_symbol_version_string()</em> called as follow (line 12059):</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_symbol_version_string</span><span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="p">(</span><span class="n">section</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_type</span> <span class="o">==</span> <span class="n">SHT_DYNSYM</span><span class="p">),</span> <span class="n">strtab</span><span class="p">,</span> <span class="n">strtab_size</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">psym</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sym_info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vna_other</span><span class="p">);</span>
</code></pre></div></div>

<p>So let’s try to understand what <em>get_symbol_version_string()</em> function returns.</p>

<p><br /></p>

<h4 id="22-understanding-get_symbol_version_string">2.2. Understanding get_symbol_version_string.</h4>

<p>Exploring the code, we find that <em>get_symbol_version_string</em> is a custom local function implemented inside the file (line 11855).</p>

<p>As an initial overview, the function reads version information from the ELF file and returns a string containing the version symbol name. Our task is to identify how this function returns the value that is filling the <em>version_string</em> variable to understand exactly what part of the ELF is being read.</p>

<p>Lets check the function; this function return NULL if:</p>

<ol>
  <li>The following statement is true:</li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">!</span><span class="n">is_dynsym</span> <span class="err">\</span><span class="o">|</span><span class="err">\</span><span class="o">|</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">version_info</span><span class="p">[</span><span class="n">DT_VERSIONTAGIDX</span> <span class="p">(</span><span class="n">DT_VERSYM</span><span class="p">)]</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></div>

<ul>
  <li>
    <p>If ‘is_dynsym’ is false or if “filedata-&gt;version_info[DT_VERSIONTAGIDX(DT_VERSYM)] == 0” is true:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_dynsym</span> <span class="o">||</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">version_info</span><span class="p">[</span><span class="n">DT_VERSIONTAGIDX</span><span class="p">(</span><span class="n">DT_VERSYM</span><span class="p">)]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>First, lets see that <em>is_dynsym</em> is defined as an argument of the function at the prototype scheme:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">get_symbol_version_string</span><span class="p">(</span><span class="n">Filedata</span> <span class="o">*</span> <span class="n">filedata</span><span class="p">,</span> <span class="n">bfd_boolean</span> <span class="n">is_dynsym</span><span class="p">,</span> <span class="p">...)</span>
</code></pre></div>    </div>

    <p>So, we retrieve the value from the call of the function just showed above:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="p">(</span><span class="n">section</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_type</span> <span class="o">==</span> <span class="n">SHT_DYNSYM</span><span class="p">)</span>
</code></pre></div>    </div>

    <p>It seems that <em>is_dynsym</em> is interpreted as a boolean value that is TRUE when “section == NULL” or when “section-&gt;sh_type == SHT_DYNSYM”</p>

    <p>–&gt; At first, <em>section</em> is passed to <em>get_symbol_version_string()</em> as a parameter and is not declared inside the caller function, <em>print_dynamic_symbol()</em> also receives this value as a parameter. This value gets declared on <em>process_symbol_table()</em> (at line 12102) as a pointer to <em>Elf_Internal_Shdr</em> (section header structure) and it uses it recursiverly in a for loop in which <em>print_dynamic_symbol()</em> gets called:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">process_symbol_table</span> <span class="p">(</span><span class="n">Filedata</span> <span class="o">*</span> <span class="n">filedata</span><span class="p">){</span>
  <span class="n">Elf_Internal_Shdr</span> <span class="o">*</span> <span class="n">section</span><span class="p">;</span>
  <span class="c1">//...</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">section</span> <span class="o">=</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">section_headers</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">file_header</span><span class="p">.</span><span class="n">e_shnum</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">section</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//...</span>
    <span class="n">print_dynamic_symbol</span><span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">symtab</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">strtab</span><span class="p">,</span> <span class="n">strtab_size</span><span class="p">);</span>
    <span class="c1">//...</span>
  <span class="p">}</span>
  <span class="c1">//..</span>
</code></pre></div>    </div>

    <p>So this <em>section</em> parameter is indeed a parameter that goes iterating on the ELF sections and when certains coniditions match, it calls <em>print_dynamic_symbol()</em>, we will see this later.</p>

    <p>–&gt; In the other hand, if <em>section</em> is not NULL, <em>sh_type</em> attribute of section must have the <em>SHT_DYNSYM</em> constant as value. The <em>sh_type</em> field categorizes what kind of data the section contains and <em>SHT_DYNSYM</em> is a constant that identifies the Dynamic Symbol Table.</p>

    <p>So, this <em>is_dynsym</em> boolean value TRUE when the section in which print_dynamic_symbol() gets called is NULL or corresponds with .dynsym.</p>
  </li>
  <li>
    <p>The other condition is that “filedata-&gt;version_info[DT_VERSIONTAGIDX(DT_VERSYM)]” must not be equal to “0”. <em>version_info</em> is an array of 16 elements of type <em>bfd_vma</em> (virtual memory address) initialize all 0 by default, DT_VERSIONTAGIDX is a macro that associates the “tag” with an index so DT_VERSIONTAGIDX(DT_VERSYM) is a number (the index in the array) and DT_VERSYM is a constant, which means that this array will have 0 value on that index if our ELF doesn’t have information available about the symbol version. We can also fairly assume that <em>version_info[DT_VERSIONTAGIDX(DT_VERSYM)]</em> contains the memory address for the Version Symbol Table.</p>
  </li>
</ul>

<p>So esentually, we can tell that this first restriction is checking that <em>get_symbol_version_string()</em> is receiving data from .dynsym section or other non-section source and if information about the version symbol is available in <em>version_info[]</em> (<em>.gnu.version</em> section).</p>

<p><br /></p>

<ol>
  <li>The second restriction try to retrieve the version symbol data on <em>data</em>, if not, return NULL:</li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">filedata</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">si</span> <span class="o">*</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">vers_data</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">"version data"</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</code></pre></div></div>

<p><br /></p>

<ol>
  <li>The third restriction is about check for non-hidden local symbols:</li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">vers_data</span> <span class="o">=</span> <span class="n">byte_get</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">vers_data</span> <span class="o">&amp;</span> <span class="n">VERSYM_HIDDEN</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">vers_data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</code></pre></div></div>

<p>Extract the contents from the version symbol table and check if the symbol is not hidden and if is a local symbol. Local symbols has no version string to return so return NULL.</p>

<p><br /></p>

<p>Then, the function take two paths;</p>

<ul>
  <li>
    <p>Check the DT_VERDEF (version definition; Versions this binary provides/exports) that the binaries provide; If symbol is not undefined (psym-&gt;st_shndx != SHN_UNDEF), is not a hidden base version (vers_data != 0x8001) vers_data and there is non-null memory address in which version is defined (filedata-&gt;version_info[DT_VERSIONTAGIDX (DT_VERDEF)]), then get the data from that address (<em>off</em> is the offset defined with <em>offset_from_vma</em> in other part of the code, we will talk about this function later) and function ultimately retunrs the <em>strtab</em> plus <em>ivda.vda_name</em>:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="p">(</span><span class="n">ivda</span><span class="p">.</span><span class="n">vda_name</span> <span class="o">&lt;</span> <span class="n">strtab_size</span> <span class="o">?</span> <span class="n">strtab</span> <span class="o">+</span> <span class="n">ivda</span><span class="p">.</span><span class="n">vda_name</span> <span class="o">:</span> <span class="n">_</span><span class="p">(</span><span class="s">"&lt;corrupt&gt;"</span><span class="p">));</span>
</code></pre></div>    </div>

    <p>We will see what is this later, until this, we just want to know that vda_name is a field from the evd structure (Elf_External_Verdef).</p>
  </li>
  <li>
    <p>Check the DT_VERNEED (version needed; versions this binary requires/imports) that the ELF imports from other libraries. This reproduces barely the same code as the other path, but instead it stuff the structure from the “version defintion section”, it reads from “version needed section”, also returns the strtab plus an <em>ivna.vna_name</em>:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="p">(</span><span class="n">ivna</span><span class="p">.</span><span class="n">vna_name</span> <span class="o">&lt;</span> <span class="n">strtab_size</span>  <span class="o">?</span> <span class="n">strtab</span> <span class="o">+</span> <span class="n">ivna</span><span class="p">.</span><span class="n">vna_name</span> <span class="o">:</span> <span class="n">_</span><span class="p">(</span><span class="s">"&lt;corrupt&gt;"</span><span class="p">));</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>In both cases returns ‘strtab + ivda.vda/vna_name’ or the string ‘“corrupt”’, so our task is now try to understand what both of this value are.</p>

<p><br /></p>

<h4 id="23-tracking-strtab-and-ivdaivna-in-get_symbol_version_string">2.3. Tracking strtab and ivda/ivna in get_symbol_version_string.</h4>

<p><strong>strtab</strong></p>

<p><em>strtab</em>; this is passed as argument to the function and is a pointer to ‘const char’:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_symbol_version_string</span><span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="p">(</span><span class="n">section</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_type</span> <span class="o">==</span> <span class="n">SHT_DYNSYM</span><span class="p">),</span> <span class="n">strtab</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></div></div>

<p>Also, in <em>print_dynamic_symbol()</em> is passsed as an argument to the function:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">void</span> <span class="n">print_dynamic_symbol</span> <span class="p">(</span><span class="n">Filedata</span> <span class="o">*</span><span class="n">filedata</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">si</span><span class="p">,</span> <span class="n">Elf_Internal_Sym</span> <span class="o">*</span><span class="n">symtab</span><span class="p">,</span> <span class="n">Elf_Internal_Shdr</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">strtab</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">strtab_size</span><span class="p">)</span>
</code></pre></div></div>

<p>So, in order to see where strtab is formed we have to keep tracking upward going to see how <em>print_dynamic_symbol()</em> gets that value. It seems that this function is called twice in side <em>process_symbol_table()</em>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">print_dynamic_symbol</span> <span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">dynamic_symbols</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">dynamic_strings</span><span class="p">,</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">dynamic_strings_length</span><span class="p">);</span> <span class="err">}</span>

<span class="n">print_dynamic_symbol</span><span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">symtab</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">strtab</span><span class="p">,</span> <span class="n">strtab_size</span><span class="p">);</span>
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>In the first call, section is NULL, which makes is_dynsym = TRUE (because section == NULL</td>
      <td> </td>
      <td>… = TRUE). However, this path uses <em>filedata-&gt;dynamic_strings</em> instead of the locally constructed strtab. <em>dynamic_strings</em> is declared in the readelf.c code:</td>
    </tr>
  </tbody>
</table>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">filedata</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="kt">char</span> <span class="o">*</span>              <span class="n">dynamic_strings</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>So, for the first call, strtab parameter is a pointer to char.</p>

<p><br /></p>

<p>Continuing with the second call, we get that strtab is a pointer to char to the string table of the ELF binary (line 12169):</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">strtab</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">get_data</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">filedata</span><span class="p">,</span> <span class="n">string_sec</span><span class="o">-&gt;</span><span class="n">sh_offset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">string_sec</span><span class="o">-&gt;</span><span class="n">sh_size</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">"string table"</span><span class="p">));</span>
</code></pre></div></div>

<p>So, it seems that strtab value is a pointer to char.</p>

<p><br /></p>

<p><strong>ivda.vda_name/ivna.vna_name</strong></p>

<p>On the other hand, we can check that <em>ivda</em> is an instance of the <em>Elf_Internal_Verdaux</em> structure as well as <em>ivna</em> is from <em>Elf_Internal_Vernaux</em>.</p>

<p>Checking internal.h header file we can check that in both cases, ivda/ivna_name are offset to the name in the string table:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">elf_internal_verdaux</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vda_name</span><span class="p">;</span>       <span class="cm">/* String table offset of name.  */</span>
  <span class="c1">//...</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">elf_internal_vernaux</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">vna_name</span><span class="p">;</span>      <span class="cm">/* String table offset to version name.  */</span>
  <span class="c1">//...</span>
</code></pre></div></div>

<p>Thus, the additions see before as returns values in <em>get_symbol_version_string()</em>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">strtab</span> <span class="o">+</span> <span class="n">ivda</span><span class="p">.</span><span class="n">vda_name</span>

<span class="n">strtab</span> <span class="o">+</span> <span class="n">ivna</span><span class="p">.</span><span class="n">vna_name</span>
</code></pre></div></div>

<p>Are the add in both cases of a pointer to an offset, giving as result an advanced pointer to the exact position in which the string of the name of the version (exported or imported) exists exactly in the string table.</p>

<p><br /></p>

<p><strong>Apend: String Table</strong></p>

<p>In ELF files, strings (like symbol names, section names, and version names) are not stored directly within structures. Instead, they are stored in a special section called the string table, and structures reference them using offsets (numerical indices).</p>

<p>A string table is simply a continuous block of bytes where:</p>

<ul>
  <li>Strings are stored sequentially.</li>
  <li>Each string is null-terminated (\0).</li>
  <li>Strings are accessed by their byte offset from the start.</li>
</ul>

<pre><code class="language-less">Offset:  0    1 2 3 4 5 6   7 8 9 10 11 12 13   14 15 16 17 18
Bytes:   \0   p r i n t f   \0 m a i  n  \0  l  i  b  c  \0
         │    └─────┬─────┘    └──┬───┘     └──┬──┘
         │          │             │            │
      (empty)    "printf"      "main"       "libc"
</code></pre>

<p>So, what would happen if the string table was filled with a unique large string without terminator byte, then, all that information would be returned to version_string and then to buffer, causing a buffer overflow and presumibly a crash of the program.</p>

<p>There are severals string tables:</p>

<ul>
  <li>.strtab - String table for symbol names (in static symbols).</li>
  <li>.dynstr - Dynamic string table (for dynamic symbols and versions).</li>
  <li>.shstrtab - Section header string table (section names).</li>
</ul>

<p>At a first glance, we would be interested in .dynstr since this process dynamic symbols and we do know that <em>get_symbol_version_string()</em> will return NULL if is not reading dynamic symbol version, so we need to keep tracking in order to see where the strtab gets the data, remember that there are two calls of <em>process_symbol_table()</em>:</p>

<p><br /></p>

<h4 id="24-understanding-print_dynamic_symbol-calls">2.4. Understanding print_dynamic_symbol calls.</h4>

<p>Let’s try to understand how this two calls receives his data, we remember that we are interested in the fifth paramater passed to the function:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">print_dynamic_symbol</span> <span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">dynamic_symbols</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">dynamic_strings</span><span class="p">,</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">dynamic_strings_length</span><span class="p">);</span> <span class="err">}</span>

<span class="n">print_dynamic_symbol</span><span class="p">(</span><span class="n">filedata</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">symtab</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">strtab</span><span class="p">,</span> <span class="n">strtab_size</span><span class="p">);</span>
</code></pre></div></div>

<p>Tracking <em>dynamic_strings</em> in the code we can see that is defined on <em>process_dynamic_section()</em> function (line 10377). Later, <em>process_object()</em> call first <em>process_dynamic_section()</em> and then calls <em>process_symbol_table()</em>, so this value is modified on <em>process_dynamic_section()</em> and then used by <em>process_symbol_table()</em>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">offset</span> <span class="o">=</span> <span class="n">offset_from_vma</span><span class="p">(</span><span class="n">filedata</span><span class="p">,</span><span class="n">filedata</span><span class="o">-&gt;</span><span class="n">dynamic_info</span><span class="p">[</span><span class="n">DT_STRTAB</span><span class="p">],</span> <span class="n">str_tab_len</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="n">filedata</span><span class="o">-&gt;</span><span class="n">dynamic_strings</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">get_data</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">filedata</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">str_tab_len</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">"dynamic string table"</span><span class="p">));</span>
</code></pre></div></div>

<p>So, dynamic_strings gets stuffed with the return value of <em>get_data()</em> which reads 1 item of the size of a string table at the offset provided by <em>offset_from_vma()</em> from <em>dynamic_info[DT_STRTAB]</em> (the address of the dynamic strint table).</p>

<p>Let’s talk a bit about <em>offset_from_vma()</em>. This function returns a file offset by converting the given virtual memory address (where data would be loaded in memory) into the corresponding position in the file, using the PT_LOAD segment mappings as a translation table.</p>

<p>This is because an ELF is meant to be executed, not read as a stream of bytes. Readelfs dumps the ELF’s content reading it from the disk so when it tries to read some part of the file, this one doesn’t have his data organize with offsets, instead, readelf resort to the PT_LOAD segment in order to find the address in which the desired data has to be loaded and transforms the distance between the start of the file and that address in an offset that functions like ‘fseek()’ or ‘fread()’ can understand.</p>

<p>Thus, it is clear that the first call of <em>print_dynamic_symbol()</em> passes <em>filedata-&gt;dynamic_strings</em> (which contains the <strong>.dynstr</strong> section) as the <em>strtab</em> parameter. Note that in this call, the section parameter is NULL so <em>is_dynsym</em> becomes TRUE and <em>get_symbol_version_string()</em> gets executed.</p>

<p>The second one gets <em>strtab</em> from:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Elf_Internal_Shdr</span> <span class="o">*</span> <span class="n">string_sec</span><span class="p">;</span>
<span class="n">string_sec</span> <span class="o">=</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">section_headers</span> <span class="o">+</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_link</span><span class="p">;</span>
<span class="n">strtab</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">get_data</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">filedata</span><span class="p">,</span> <span class="n">string_sec</span><span class="o">-&gt;</span><span class="n">sh_offset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">string_sec</span><span class="o">-&gt;</span><span class="n">sh_size</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">"string table"</span><span class="p">));</span>
</code></pre></div></div>

<p>This assignment is inside a loop in which only parses symbol tables sections.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">section</span> <span class="o">=</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">section_headers</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">filedata</span><span class="o">-&gt;</span><span class="n">file_header</span><span class="p">.</span><span class="n">e_shnum</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">section</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_type</span> <span class="o">!=</span> <span class="n">SHT_SYMTAB</span> <span class="o">&amp;&amp;</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_type</span> <span class="o">!=</span> <span class="n">SHT_DYNSYM</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">do_syms</span> <span class="o">&amp;&amp;</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_type</span> <span class="o">==</span> <span class="n">SHT_SYMTAB</span><span class="p">))</span>
  <span class="k">continue</span><span class="p">;</span>
</code></pre></div></div>

<p>Each <em>symbol section</em> structure (.symtab and .dynsym) has a <em>sh_link</em> field which is an index to the associated string table from the section pointer:</p>

<pre><code class="language-less">.symtab → .strtab
.dynsym → .dynstr
</code></pre>
<p>Although, every section has a <em>sh_type</em> field which as value have a constant that denotes the type of the the section:</p>

<ul>
  <li>SHT_SYMTAB → .symtab → .strtab</li>
  <li>SHT_DYMSYM → .dynsym → .dynstr</li>
</ul>

<p>On the same file, we can see that <em>section_headers</em> is a pointer to <em>Elf_Internal_Shdr</em> structure:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">filedata</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="n">Elf_Internal_Shdr</span> <span class="o">*</span>  <span class="n">section_headers</span><span class="p">;</span>
  <span class="c1">//...</span>
</code></pre></div></div>

<p>On internal.h file we find this information:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">elf_internal_shdr</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">sh_type</span><span class="p">;</span>		<span class="cm">/* Type of section */</span>
  <span class="c1">//...</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">sh_link</span><span class="p">;</span>		<span class="cm">/* Index of another section */</span>
  <span class="c1">//...</span>
<span class="p">}</span> <span class="n">Elf_Internal_Shdr</span><span class="p">;</span>
</code></pre></div></div>

<p>Despite the generic comment on sh_link, in the cases of SHT_SYMTAB/SHT_DYNSYM values it points to the string table used by this symbol table.</p>

<p>So, getting back to the second <em>print_dynamic_symbol()</em> call, we can infere that <em>string_sec</em> is, for each symbol section on the loop, an advanced pointer to the corresponding string table. Thus, in this call, the <em>strtab</em> value is also holding information from <em>.strtab</em> or <em>.dynstr</em>.</p>

<p>But, we must notice that <em>get_symbol_version_string()</em> have a constraint involving the <em>is_dynsym</em> boolean value which checks the <em>sh_type</em> flag and only continue if this is equal to SHT_DYNSYM. In other words, in this second call, <em>get_symbol_version_string()</em> also process information from <em>.dynstr</em> if gets executed, so in boths calls, the entry point at the ELF file is <em>.dynstr</em>.</p>

<p><br /></p>

<h3 id="3-crafting-the-poc">3. Crafting the PoC.</h3>

<h4 id="31-crafting-a-simple-elf-introduction-to-elf">3.1. Crafting a simple ELF. Introduction to ELF.</h4>

<p><strong>Introduction to ELF format</strong></p>

<p>ELF = Executable and Linkable Format It’s a file format used on Linux/Unix systems for executables, shared libraries or objects files.</p>

<p>The structure for an ELF binary file is like the following:</p>

<pre><code class="language-less">┌─────────────────────────────────┐
│ ELF Header                      │ ← "This is a 64-bit executable"
├─────────────────────────────────┤
│ Program Headers                 │ ← "Load this code at address 0x400000"
├─────────────────────────────────┤
│ Code &amp; Data                     │ ← The actual machine instructions
├─────────────────────────────────┤
│ Section Headers (optional)      │ ← "Here's where .text, .data are"
└─────────────────────────────────┘
</code></pre>

<ul>
  <li>
    <p><strong>ELF Header</strong>; is the beginning part of an ELF and it contains essential metadata about the file. The purpouse of the ELF header is to transmit at the very beginning essential information about the file to the OS Loader like binary type (executable, shared library, etc), arquitecture (x64, x86, ARM, etc) and file mapping (offsets or pointers to symbol tables, sections headers, etc).</p>
  </li>
  <li>
    <p><strong>Program Headers</strong>; (also called <em>segment headers</em>) are a table of entries that describe segments in an ELF file. They tell the OS loader how to load the executable into memory at runtime (memory layout, Permissions, Dynamic linking, etc).</p>
  </li>
  <li>
    <p><strong>Code &amp; Data</strong>; contains machine code, initialized data, etc, essentially is the actual content the program which gets loaded in memory and executed.</p>
  </li>
  <li>
    <p><strong>Section Headers</strong>; are a table at the end of the ELF file that describes logical divisions of the code &amp; data part for linking and debugging purposes. Section headers are optional for execution, a stripped executable can run without them because the OS loader only needs the program headers.</p>
  </li>
</ul>

<p><br /></p>

      </article>

      
        <div class="blog-tags">
          <span>Tags:</span>
          
            <a href="/tags#csoft">csoft</a>
          
        </div>
      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=CVE-2021-20294.&url=http%3A%2F%2Flocalhost%3A4000%2F2025-11-07-CVE-2021-20294%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2025-11-07-CVE-2021-20294%2F"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2025-11-07-CVE-2021-20294%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/2025-11-06-LSBO/" data-toggle="tooltip" data-placement="top" title="(Linear) Stack Buffer Overflow.">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/2025-11-08-ComputerRegisters/" data-toggle="tooltip" data-placement="top" title="Computer Registers.">Next Post &rarr;</a>
        </li>
        
      </ul>
      
  
  
  

  


  



    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="/feed.xml" title="RSS">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">RSS</span>
    </a>
  </li><li class="list-inline-item">
    <a href="mailto:" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/Qv1nTv5" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/Qvintvs1" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://linkedin.com/in/german-sanmillan-68b308229/" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        German
        &nbsp;&bull;&nbsp;
      
      2026

      

      
      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
